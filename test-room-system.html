<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Room System - Offline & Cloud</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .test-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #e0e0e0;
        }
        .test-card h3 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 10px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.6;
        }
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        .badge.cloud {
            background: #10b981;
            color: white;
        }
        .badge.offline {
            background: #f59e0b;
            color: white;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 8px;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            ğŸ§ª Test Room System
            <span class="badge offline">ğŸ’¾ Offline Mode</span>
        </h1>
        <p class="subtitle">
            Test há»‡ thá»‘ng phÃ²ng thi vá»›i cháº¿ Ä‘á»™ Offline vÃ  Cloud
        </p>

        <!-- Test 1: Create Offline Room -->
        <div class="test-section">
            <h2>ğŸ“ Test 1: Táº¡o PhÃ²ng Offline</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Táº¡o phÃ²ng má»›i</h3>
                    <input type="text" id="room-name" placeholder="TÃªn phÃ²ng..." value="Test Room 1">
                    <input type="text" id="room-code" placeholder="MÃ£ phÃ²ng (6 sá»‘)..." value="123456">
                    <button onclick="testCreateOfflineRoom()">
                        ğŸ’¾ Táº¡o PhÃ²ng Offline
                    </button>
                    <div id="result-create" class="result" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Test 2: Load Rooms -->
        <div class="test-section">
            <h2>ğŸ“‚ Test 2: Load Danh SÃ¡ch PhÃ²ng</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Load tá»« localStorage</h3>
                    <button onclick="testLoadRooms()">
                        ğŸ“‚ Load Rooms
                    </button>
                    <div id="result-load" class="result" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Test 3: Join Room -->
        <div class="test-section">
            <h2>ğŸšª Test 3: VÃ o PhÃ²ng</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Join báº±ng mÃ£</h3>
                    <input type="text" id="join-code" placeholder="Nháº­p mÃ£ phÃ²ng..." value="123456">
                    <button onclick="testJoinRoom()">
                        ğŸšª Join Room
                    </button>
                    <div id="result-join" class="result" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Test 4: Delete Room -->
        <div class="test-section">
            <h2>ğŸ—‘ï¸ Test 4: XÃ³a PhÃ²ng</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>XÃ³a phÃ²ng offline</h3>
                    <input type="text" id="delete-code" placeholder="MÃ£ phÃ²ng cáº§n xÃ³a..." value="123456">
                    <button onclick="testDeleteRoom()">
                        ğŸ—‘ï¸ Delete Room
                    </button>
                    <div id="result-delete" class="result" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Test 5: Clear All -->
        <div class="test-section">
            <h2>ğŸ§¹ Test 5: XÃ³a Táº¥t Cáº£</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Reset localStorage</h3>
                    <button onclick="testClearAll()" style="background: #dc2626;">
                        ğŸ§¹ Clear All Data
                    </button>
                    <div id="result-clear" class="result" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test Functions
        function testCreateOfflineRoom() {
            const resultDiv = document.getElementById('result-create');
            const roomName = document.getElementById('room-name').value;
            const roomCode = document.getElementById('room-code').value;

            try {
                // Validate
                if (!roomName || !roomCode) {
                    throw new Error('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!');
                }

                if (roomCode.length !== 6 || !/^\d{6}$/.test(roomCode)) {
                    throw new Error('MÃ£ phÃ²ng pháº£i lÃ  6 chá»¯ sá»‘!');
                }

                // Get existing rooms
                const rooms = JSON.parse(localStorage.getItem('offlineRooms') || '[]');

                // Check duplicate
                if (rooms.some(r => r.code === roomCode)) {
                    throw new Error('MÃ£ phÃ²ng Ä‘Ã£ tá»“n táº¡i!');
                }

                // Create room
                const room = {
                    id: 'offline_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: roomName,
                    code: roomCode,
                    description: 'Test room',
                    quiz: {
                        id: 'test_quiz',
                        title: 'Test Quiz',
                        questions: [],
                        totalQuestions: 0
                    },
                    creatorId: getCreatorId(),
                    creatorName: 'Test User',
                    createdAt: new Date().toISOString(),
                    participants: 0,
                    attempts: 0,
                    leaderboard: [],
                    mode: 'offline'
                };

                // Save
                rooms.push(room);
                localStorage.setItem('offlineRooms', JSON.stringify(rooms));

                // Show result
                resultDiv.className = 'result success';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    âœ… <strong>Táº¡o phÃ²ng thÃ nh cÃ´ng!</strong><br>
                    ğŸ“ TÃªn: ${roomName}<br>
                    ğŸ”‘ MÃ£: ${roomCode}<br>
                    ğŸ’¾ Mode: Offline<br>
                    ğŸ†” ID: ${room.id}
                `;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `âŒ <strong>Lá»—i:</strong> ${error.message}`;
            }
        }

        function testLoadRooms() {
            const resultDiv = document.getElementById('result-load');

            try {
                const rooms = JSON.parse(localStorage.getItem('offlineRooms') || '[]');
                const creatorId = getCreatorId();
                const myRooms = rooms.filter(r => r.creatorId === creatorId);

                resultDiv.className = 'result info';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    ğŸ“Š <strong>Thá»‘ng kÃª:</strong><br>
                    ğŸ“‚ Tá»•ng sá»‘ phÃ²ng: ${rooms.length}<br>
                    ğŸ‘¤ PhÃ²ng cá»§a tÃ´i: ${myRooms.length}<br>
                    ğŸ†” Creator ID: ${creatorId}<br><br>
                    <strong>Danh sÃ¡ch:</strong><br>
                    ${myRooms.map(r => `â€¢ ${r.name} (${r.code})`).join('<br>') || 'ChÆ°a cÃ³ phÃ²ng nÃ o'}
                `;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `âŒ <strong>Lá»—i:</strong> ${error.message}`;
            }
        }

        function testJoinRoom() {
            const resultDiv = document.getElementById('result-join');
            const code = document.getElementById('join-code').value;

            try {
                if (!code) {
                    throw new Error('Vui lÃ²ng nháº­p mÃ£ phÃ²ng!');
                }

                const rooms = JSON.parse(localStorage.getItem('offlineRooms') || '[]');
                const room = rooms.find(r => r.code === code);

                if (!room) {
                    throw new Error('KhÃ´ng tÃ¬m tháº¥y phÃ²ng vá»›i mÃ£: ' + code);
                }

                resultDiv.className = 'result success';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    âœ… <strong>TÃ¬m tháº¥y phÃ²ng!</strong><br>
                    ğŸ“ TÃªn: ${room.name}<br>
                    ğŸ”‘ MÃ£: ${room.code}<br>
                    ğŸ‘¤ NgÆ°á»i táº¡o: ${room.creatorName}<br>
                    ğŸ“… NgÃ y táº¡o: ${new Date(room.createdAt).toLocaleString('vi-VN')}<br>
                    ğŸ’¾ Mode: ${room.mode || 'offline'}
                `;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `âŒ <strong>Lá»—i:</strong> ${error.message}`;
            }
        }

        function testDeleteRoom() {
            const resultDiv = document.getElementById('result-delete');
            const code = document.getElementById('delete-code').value;

            try {
                if (!code) {
                    throw new Error('Vui lÃ²ng nháº­p mÃ£ phÃ²ng!');
                }

                const rooms = JSON.parse(localStorage.getItem('offlineRooms') || '[]');
                const room = rooms.find(r => r.code === code);

                if (!room) {
                    throw new Error('KhÃ´ng tÃ¬m tháº¥y phÃ²ng vá»›i mÃ£: ' + code);
                }

                // Delete
                const updatedRooms = rooms.filter(r => r.code !== code);
                localStorage.setItem('offlineRooms', JSON.stringify(updatedRooms));

                resultDiv.className = 'result success';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    âœ… <strong>XÃ³a phÃ²ng thÃ nh cÃ´ng!</strong><br>
                    ğŸ“ ÄÃ£ xÃ³a: ${room.name}<br>
                    ğŸ”‘ MÃ£: ${code}<br>
                    ğŸ“Š CÃ²n láº¡i: ${updatedRooms.length} phÃ²ng
                `;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `âŒ <strong>Lá»—i:</strong> ${error.message}`;
            }
        }

        function testClearAll() {
            const resultDiv = document.getElementById('result-clear');

            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a Táº¤T Cáº¢ dá»¯ liá»‡u?')) {
                return;
            }

            try {
                const rooms = JSON.parse(localStorage.getItem('offlineRooms') || '[]');
                const count = rooms.length;

                localStorage.removeItem('offlineRooms');
                localStorage.removeItem('creatorId');
                localStorage.removeItem('userRoomHistory');

                resultDiv.className = 'result success';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    âœ… <strong>ÄÃ£ xÃ³a táº¥t cáº£!</strong><br>
                    ğŸ—‘ï¸ ÄÃ£ xÃ³a ${count} phÃ²ng<br>
                    ğŸ§¹ localStorage Ä‘Ã£ Ä‘Æ°á»£c reset
                `;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `âŒ <strong>Lá»—i:</strong> ${error.message}`;
            }
        }

        function getCreatorId() {
            let creatorId = localStorage.getItem('creatorId');
            if (!creatorId) {
                creatorId = 'creator_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('creatorId', creatorId);
            }
            return creatorId;
        }

        // Auto load on page load
        window.addEventListener('load', () => {
            console.log('ğŸ§ª Room System Test Page Loaded');
            console.log('ğŸ’¾ Creator ID:', getCreatorId());
        });
    </script>
</body>
</html>
